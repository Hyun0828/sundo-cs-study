### 01. ER 다이어그램

**ERD(ER 다이어그램)**

- 앞 장에서 RDBMS를 배우며 엔티티 집합과 엔티티 간의 관계를 테이블과 테이블의 관계로 표현하는 방법을 배웠습니다. 이러한 데이터베이스를 구성하는 요소들의 관계, 즉 엔티티 관계를 나타낸 그림을 ERD라고 합니다.
- ERD를 활용하면 추후에 데이터베이스를 확장하거나 수정할 때 어떤 부분이 영향을 받는지 쉽게 파악할 수 있어 유지보수가 용이하고 개발자 간 원할한 소통이 가능합니다.
- **피터 첸 표기법**
    
    ![image](https://github.com/user-attachments/assets/d8d3a103-944f-45c7-a366-785f2af26d83)
    
    [출처](https://velog.io/@yooonji08/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-ER%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8%EC%9D%84-IE%ED%91%9C%EA%B8%B0%EB%B2%95%EC%9C%BC%EB%A1%9C-%EB%B0%94%EA%BE%B8%EA%B8%B0)
    
    위와 같은 ERD 표기 방식을 피터 첸 표기법이라고 합니다. 이는 엔티티를 개념적으로 모델링하는 데는 유용하지만, 엔티티가 많아질 경우 그림이 다소 복잡해지고 RDBMS 상에서 어떻게 테이블의 형태로 표현되는지 한 눈에 파악하기 어려울 수 있습니다. 그래서 오늘날에는 잘 사용하지 않습니다.
    
- 오늘날에는 RDBMS 모델링을 위해 다음과 같은 형태의 ERD를 사용합니다.

    ![image](https://github.com/user-attachments/assets/dd03c554-7ce9-4bb1-b68e-937e8fa9e12a)
    
    [출처](https://vertabelo.com/blog/what-is-erd/)
    
    상단 사각형에 테이블 이름, 내부에 속성(필드) 이름, 필드 타입을 씁니다. 기본 키를 PK라고 표기하고, 외래 키를 FK라고 표기합니다.
    
    이러한 EDR 표기 방식을 **IE 표기법**, **새 발 표기법** 혹은 **까마귀 발 표기법**이라고 합니다.
    
    ![image](https://github.com/user-attachments/assets/c83d0f6d-cc62-4894-9af9-5ed919c61347)
    
    [출처](https://satisfactoryplace.tistory.com/233)
    
    1. 0 또는 하나의 엔티티와 연관되는 관계를 의미합니다.
    2. 반드시 하나의 엔티티와 연관되어야 합니다.
    3. 2번과 동일하고, 연결관계가 불변합니다.
    4. 연결되지 않거나 하나 이상의 여러 엔티티와 연관됩니다.
    5. 하나 혹은 그 이상의 여러 엔티티와 연관됩니다.
    6. 2개 이상의 여러 엔티티와 연관됩니다.
    
    ![image](https://github.com/user-attachments/assets/e716ba6b-1ee7-4722-918b-30c5493cb7ac)
    
    - 식별 관계는 참조되는 엔티티가 존재해야만 참조하는 엔티티가 존재할 수 있는 관계를 말합니다.
    - 비식별 관계는 참조되는 엔티티가 존재하지 않아도 참조하는 엔티티가 존재할 수 있는 관계를 말합니다.

### 02. 정규화

| 학번 | 이름 | 수강 과목 | 담당 교수 |
| --- | --- | --- | --- |
| 1 | 김철수 | 운영체제, 데이터베이스 | 강교수 |
| 2 | 이영희 | 컴퓨터구조, 운영체제 | 이교수 |
| 3 | 박민수 | 교양의이해, 자료구조 | 박교수 |
| … | … | … | … |

위와 같은 테이블에서 ‘수강 과목’의 데이터 중 일부를 검색하거나 일부 과목의 이름을 수정할 경우 매우 번거롭고, 검색의 성능이 저하될 수 있습니다. 이는 ‘수강 과목’의 필드의 값이 단일한 값을 가지고 있지 않기 때문입니다.

| 학생ID | 과목 코드 | 학생 이름 | 담당 교수 | 과목 이름 |
| --- | --- | --- | --- | --- |
| 1 | CS101 | 김철수 | 이교수 | 데이터베이스 |
| 2 | CS102 | 이영희 | 박교수 | 운영체제 |
| 1 | CS102 | 김철수 | 박교수 | 운영체제 |
| 3 | CS101 | 박민수 | 이교수 | 데이터베이스 |

위와 같은 테이블에서는 담당 교수나 과목의 이름이 변경될 때마다 관련된 모든 행을 수정하지 않으면 데이터에 불일치가 발생할 수 있습니다. 또 만약 과목 코드에 해당하는 과목 이름이 변경된다면 관련된 모든 행을 일일이 수정해야합니다.

**정규화**

- 잠재적인 문제가 발생하지 않도록 테이블의 필드를 구성하고, 필요할 경우 테이블을 나누는 작업입니다.
- 정규형의 종류에는 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형, 제4정규형, 제5정규형이 있습니다. 대부분의 경우 제3정규형, 보이스/코드 정규형까지만 수행됩니다.

**제1정규형**

- 모든 속성이 원자 값을 가집니다. 즉, 제1정규형은 필드 데이터가 더 이상 쪼개질 수 없는 값을 가져야합니다.
- 위에서 보았던 테이블을 제1정규형을 만족하도록 만들어보겠습니다.
    
    
    | 학번 | 이름 | 수강 과목 | 담당 교수 |
    | --- | --- | --- | --- |
    | 1 | 김철수 | 운영체제, 데이터베이스 | 강교수 |
    | 2 | 이영희 | 컴퓨터구조, 운영체제 | 이교수 |
    | 3 | 박민수 | 교양의이해, 자료구조 | 박교수 |
    | … | … | … | … |
    
    첫번째 방법은 중복되는 레코드를 감수하고 하나의 테이블로 설계하는 방법입니다.
    
    | 학번 | 이름 | 수강 과목 | 담당 교수 |
    | --- | --- | --- | --- |
    | 1 | 김철수 | 운영체제 | 강교수 |
    | 1 | 김철수 | 데이터베이스 | 강교수 |
    | 2 | 이영희 | 컴퓨터구조 | 이교수 |
    | 2 | 이영희 | 운영체제 | 이교수 |
    | 3 | 박민수 | 교양의이해 | 박교수 |
    | 3 | 박민수 | 자료구조 | 박교수 |
    | … | … | … | … |
    
    두번째 방법은 테이블을 2개로 쪼개는 방법입니다.
    
    | 학번 | 이름 |
    | --- | --- |
    | 1 | 김철수 |
    | 2 | 이영희 |
    | 3 | 박민수 |
    | … | … |
    
    | 학번 | 수강 과목 | 담당 교수 |
    | --- | --- | --- |
    | 1 | 운영체제 | 강교수 |
    | 1 | 데이터베이스 | 강교수 |
    | 2 | 컴퓨터구조 | 이교수 |
    | 2 | 운영체제 | 이교수 |
    | 3 | 교양의이해 | 박교수 |
    | 3 | 자료구조 | 박교수 |
    | … | … | … |
    
    제1정규화를 거쳐도 여전히 문제의 여지가 있을 경우 추가적인 정규화가 필요합니다.
    

**제2정규형**

- 제1정규형을 만족함과 동시에, 기본 키가 아닌 모든 필드들이 모든 기본키에 완전히 종속됩니다.
- 보통 기본키가 2개 이상의 필드로 구성될 때 고려됩니다. 테이블의 모든 필드가 기본 키에 완전히 종속되어야 하고, 일부 기본키에만 종속되어서도 안됩니다.
이때 기본 키가 아닌 필드가 기본 키의 일부에 종속되어 있는 경우 **부분 함수 종속성**이 있다고 합니다.
기본 키 전체에 완전하게 종속되어 있는 경우 **완전 함수 종속성**이 있다고 합니다.
즉, 제2정규형은 부분 함수 종속성이 없는 상태, 후보 키에 속하지 않는 모든 필드가 기본 키에 완전 함수 종속인 상태라고 할 수 있습니다.
- 아래 테이블을 확인해보겠습니다.
    
    
    | 학번 | 이름 | 과목 | 성적 |
    | --- | --- | --- | --- |
    | 1001 | 김철수 | 국어 | 90 |
    | 1001 | 김철수 | 수학 | 80 |
    | 1002 | 이영희 | 국어 | 75 |
    | 1002 | 이영희 | 영어 | 85 |
    
    이 테이블에서 ‘이름’은 ‘학번’과 종속 관계는 있을 수 있지만, ‘과목’과는 관계가 없으므로 제2정규형을 만족하지 않습니다. 테이블을 제2정규형에 맞게 분할하면 아래와 같이 됩니다.
    
    | 학번 | 이름 |
    | --- | --- |
    | 1001 | 김철수 |
    | 1002 | 이영희 |
    
    | 학번 | 과목 | 성적 |
    | --- | --- | --- |
    | 1001 | 국어 | 90 |
    | 1001 | 수학 | 80 |
    | 1002 | 국어 | 75 |
    | 1002 | 영어 | 85 |

**제3정규형**

- 제2정규형을 만족하면서, 기본 키가 아닌 모든 필드가 기본 키에 이행적 종속성이 없는 상태입니다.
- **이행적 종속성 :** 테이블에 A, B, C라는 필드가 있을 때 A가 B를 결정하고 B가 C를 결정한다면 A도 C를 결정하게 되어 종속 관계를 형성합니다. 이때 필드 A와 C 사이에 이행적 종속관계가 있다고 합니다.
    
    
    | 학번 | 학과 | 학과 사무실 위치 |
    | --- | --- | --- |
    | 1000 | 컴퓨터과학 | 미디어동100호 |
    | 1001 | 경영학 | 한빛동200호 |
    
    위 테이블에서 (학번 → 학과), (학과 → 학과 사무실 위치)이므로 곧 (학번 → 학과 사무실 위치)를 만족합니다. 따라서 ‘학번’과 ‘학과 사무실 위치’는 이행적 종속 관계입니다. 제3규형을 만족시키기 위해서 테이블을 쪼개면 아래와 같이 됩니다.
    
    | 학번 | 학과 |
    | --- | --- |
    | 1000 | 컴퓨터과학 |
    | 1001 | 경영학 |
    
    | 학과 | 학과 사무실 위치 |
    | --- | --- |
    | 컴퓨터과학 | 미디어동100호 |
    | 경영학 | 한빛동200호 |

**보이스/코드 정규형(BCNF)**

- 제3정규형을 만족하는 동시에 모든 결정자가 후보 키여야합니다.
결정자란 특정 필드를 식별할 수 있는 필드를 의미합니다. 필드 A가 필드 B를 결정할 경우 A는 B의 결정자라고 합니다.
- 아래 테이블을 보겠습니다.
    
    
    | 학번 | 과목 | 담당 교수 |
    | --- | --- | --- |
    | 1 | 데이터베이스 | 김교수 |
    | 1 | 자료구조 | 이교수 |
    | 2 | 프로그래밍 | 박교수 |
    | 2 | 자료구조 | 고교수 |
    | 3 | 데이터베이스 | 김교수 |
    
    각 교수는 한 과목만 맡을 수 있으므로 ‘과목’에 대해 결정자입니다. 하지만 ‘담당 교수’만 가지고는 튜플을 식별할 수 없습니다. 즉, 후보키가 될 수 없습니다. 이를 BCNF를 만족하게 테이블을 분할하면 아래와 같이 됩니다.
    
    | 학번 | 담당 교수 |
    | --- | --- |
    | 1 | 김교수 |
    | 1 | 이교수 |
    | 2 | 박교수 |
    | 2 | 고교수 |
    | 3 | 김교수 |
    
    | 담당 교수 | 과목 |
    | --- | --- |
    | 김교수 | 데이터베이스 |
    | 이교수 | 자료구조 |
    | 박교수 | 프로그래밍 |
    | 고교수 | 자료구조 |
